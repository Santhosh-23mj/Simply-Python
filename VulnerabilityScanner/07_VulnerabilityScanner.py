#!/usr/bin/python3

"""
Program_7
The Most Basic Vulnerability Scanner!
"""
import socket
import os
import sys

def retBanner(ip,port):
    s = socket.socket()
    try:
        s.connect((ip,port))
        res = s.recv(1024)
        return res
    except Exception as e:
        print("[-] Error - "+str(e))
        return


def checkVulns(res,file):
    f = open(file,'r')
    for line in f.readline():
        if( line.strip('\r') in res ):
            print("[+] - "+ line +" is vulnerable")
            return
    return


def main():
    if( len(sys.argv) == 2 ):
        filename = str(sys.argv[1])
        if not os.path.isfile(filename):
            print("[-] "+filename+" doesnt exist")
            exit(0)
        if not os.access(filename,os.R_OK):
            print("[-] Access denied to read "+filename)
            exit(0)
    else:
        print("Usage : "+str(sys.argv[0])+"<vuln service file>")
    portlist = [21,22,25,80,110,443]
    for i in range(0,254):
        for port in portlist:
            ip = "192.168.0."+str(i)
            banner = retBanner(ip,port)
            if(banner):
                print("[+] "+ip+":"+str(port)+banner.strip('\n'))
                checkVulns(banner,filename)


if __name__ == '__main__':
    main()
